---
import '../styles/global.css'
import { Image } from 'astro:assets'; // 导入 Image 组件
import Layout from "../layouts/Layout.astro";
import AppHeader from '../components/Header.astro';
import AppFooter from '../components/Footer.astro';

// 1. 获取所有文章
const allPosts = Object.values(import.meta.glob('./posts/*.md', { eager: true })) as any[];

// 2. 核心逻辑：获取 assets 下的所有图片对象
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/common/*.{jpeg,jpg,png,gif,webp,avif}', { eager: true });

// 3. 排序（可选：按日期倒序）
const sortedPosts = allPosts.sort((a, b) =>
    Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate)
);
---

<Layout>
    <AppHeader />

    <section class="py-20 min-h-screen bg-[var(--main-bg)] overflow-x-hidden">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-15">
                <h1 class="title text-5xl font-black">博客</h1>
                <p class="mt-4 text-gray-500">Thoughts, notes, and fragments.</p>
            </div>

            <div class="p-3">
                {sortedPosts.map(({ url, frontmatter, rawContent }) => {
                    // 拼凑图片路径逻辑：/src/assets/common/ + MD里的文件名
               const imagePath = `/src/assets/common/${frontmatter.image?.url}`;
                    const postImage = images[imagePath]?.default;
                    return (
                            <a href={url} class="flex gap-6 items-center bg-white p-5 border-2 border-black mb-6 transition-all duration-200 hover:shadow-[8px_8px_0px_rgba(0,0,0,1)] hover:-translate-y-1 group">
                                {/* 图片预览容器 */}
                                <div class="flex-shrink-0">
                                    <div class="w-[180px] h-[120px] overflow-hidden border-2 border-black bg-gray-100">
                                        {postImage ? (
                                                <Image
                                                        src={postImage}
                                                        alt={frontmatter.title}
                                                        width={400}
                                                        height={260}
                                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                                />
                                        ) : (
                                                <div class="w-full h-full flex items-center justify-center text-gray-400 text-xs">No Image</div>
                                        )}
                                    </div>
                                </div>

                                {/* 文字内容 */}
                                <div class="flex flex-col gap-2 overflow-hidden">
                                    <h2 class="line-clamp-2 text-2xl font-black group-hover:text-[var(--purple-m)] transition-colors">
                                        {frontmatter.title}
                                    </h2>
                                    {/* 建议在 MD 中添加 description 字段，rawContent 会包含 YAML 源码导致显示混乱 */}
                                    <p class="line-clamp-2 text-gray-600 text-sm leading-relaxed">
                                        {rawContent || "Click to read more..."}
                                    </p>
                                    <div class="flex gap-4 mt-1 text-[10px] font-bold uppercase tracking-widest text-gray-400">
                                        <span>{frontmatter.pubDate}</span>
                                        {frontmatter.tags && <span>{frontmatter.tags[0]}</span>}
                                    </div>
                                </div>
                            </a>
                    )
                })}
            </div>
        </div>
    </section>

    <AppFooter />
</Layout>