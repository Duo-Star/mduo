---
import '../styles/global.css'
import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';

import AppHeader from './Header.astro';
import AppFooter from './Footer.astro';
import CallToAction from './CallToAction.astro';

const styleSheet = {
    actions: 'text-gray-500 flex items-center gap-2 hover:text-gray-700',
}

const { frontmatter } = Astro.props;

/** * 核心逻辑修改：
 */
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/common/*.{jpeg,jpg,png,gif,webp}');

// 1. 安全提取路径，如果 frontmatter.image 没定义则为 null
const imageFileName = frontmatter.image?.url;
const imagePath = imageFileName ? `/src/assets/common/${imageFileName}` : null;

// 2. 只有当路径存在且在 glob 列表中能找到时，才标记为有效
const hasImage = imagePath && images[imagePath];
---
<Layout>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
            integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
            crossorigin="anonymous"
    />
    <AppHeader />

    <section class="mb-30 p-3">
        <div class="max-w-3xl mx-auto p-3 bg-white flex flex-col gap-7 border-3 mt-10 shadow-[8px_8px_0px_rgba(0,0,0,1)]">

            {/* 3. 使用逻辑与判断：只有 hasImage 为真时才渲染图片区域 */}
            {hasImage && (
                    <Image
                            src={images[imagePath]()}
                            alt={frontmatter.image.alt || "Cover"}
                            width={800}
                            height={450}
                            class="w-full border-2 border-black object-cover"
                    />
            )}

            <h1 class="title text-4xl font-black">{frontmatter.title}</h1>

            <div class="flex flex-col">
                <div class="flex border-t-2 border-b-2 border-black mb-10 py-4">
                    <div class="flex-1 flex gap-6">
                        <span class={styleSheet.actions}><i class="ri-thumb-up-line text-xl"></i> {frontmatter.likes}</span>
                        <span class={styleSheet.actions}><i class="ri-chat-1-line text-xl"></i> {frontmatter.comments}</span>
                    </div>
                </div>

                <article class="prose prose-lg max-w-none prose-headings:font-black prose-p:text-gray-700">
                    <slot />
                </article>
            </div>
        </div>
    </section>

    <CallToAction />
    <AppFooter />
</Layout>

<style is:global>
    /* ... 保持不变 ... */
</style>